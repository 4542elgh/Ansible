---
- name: "Update system"
  hosts: "all"
  tasks:
  - name: "Update system Debian based"
    block:
    - name: Update the apt package index
      apt:
        update_cache: yes
        cache_valid_time: 3600  # Update the cache if it's older than 1 hour
    - name: Perform dist-upgrade
      apt:
        upgrade: dist
        autoremove: yes  # Optional: remove obsolete packages
        autoclean: yes   # Optional: clean up the package cache
    when: ansible_pkg_mgr is defined and ansible_pkg_mgr == "apt"